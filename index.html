<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Rubika QR Generator</title>
<script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
<style>
  body {
    background-color: #0a0a0a;
    color: #fff;
    font-family: "Vazirmatn", sans-serif;
    text-align: center;
    padding: 30px;
  }

  h1 {
    font-size: 2em;
    color: #0ef;
    font-family: "Orbitron", sans-serif;
    text-shadow: 0 0 10px #0ef, 0 0 20px #0ef;
    margin-bottom: 20px;
  }

  input {
    width: 80%;
    max-width: 400px;
    padding: 10px;
    border-radius: 10px;
    border: none;
    outline: none;
    background: #111;
    color: white;
    margin-bottom: 10px;
    font-size: 1em;
  }

  button {
    background: #0ef;
    border: none;
    padding: 10px 20px;
    border-radius: 10px;
    font-size: 1em;
    cursor: pointer;
    color: #000;
    transition: 0.3s;
    margin: 5px;
  }

  button:hover {
    background: #00bcd4;
    box-shadow: 0 0 20px #00bcd4;
  }

  canvas {
    margin-top: 20px;
    border-radius: 20px;
    background: #fff;
    padding: 10px;
  }

  #limitMsg {
    color: #f00;
    margin-top: 10px;
  }
</style>
</head>
<body>
  <h1>Rubika.ir/vps_plus</h1>
  <input type="text" id="textInput" placeholder="آدرس یا متن خود را وارد کنید...">
  <div>
    <button onclick="generateQR()">ساخت QR</button>
    <button onclick="downloadQR()">ذخیره در گالری</button>
  </div>
  <canvas id="qrCanvas"></canvas>
  <p id="limitMsg"></p>

<script>
const canvas = document.getElementById('qrCanvas');
const ctx = canvas.getContext('2d');
let qrCount = 0;

// تابع بررسی محدودیت روزانه
function canGenerate() {
  const today = new Date().toLocaleDateString();
  const saved = JSON.parse(localStorage.getItem("qrLimit")) || {};
  if (saved.date !== today) {
    localStorage.setItem("qrLimit", JSON.stringify({ date: today, count: 0 }));
    return true;
  }
  if (saved.count >= 2) return false;
  return true;
}

function increaseCount() {
  const today = new Date().toLocaleDateString();
  const saved = JSON.parse(localStorage.getItem("qrLimit")) || { date: today, count: 0 };
  saved.date = today;
  saved.count = (saved.count || 0) + 1;
  localStorage.setItem("qrLimit", JSON.stringify(saved));
}

async function generateQR() {
  if (!canGenerate()) {
    document.getElementById("limitMsg").textContent = "❌ شما امروز ۲ بار QR ساخته‌اید. لطفاً فردا دوباره امتحان کنید.";
    return;
  }

  const text = document.getElementById('textInput').value.trim() || "https://rdnsparham-rgb.github.io/QR";
  const qrSize = 300;

  canvas.width = qrSize;
  canvas.height = qrSize;
  await QRCode.toCanvas(canvas, text, {
    width: qrSize,
    margin: 1,
    color: {
      dark: "#000000",
      light: "#ffffff"
    }
  });

  // افزودن باکس و متن وسط QR
  const boxWidth = 150;
  const boxHeight = 70;
  const x = (qrSize - boxWidth) / 2;
  const y = (qrSize - boxHeight) / 2;

  // باکس مشکی با گوشه‌های گرد
  ctx.fillStyle = "black";
  ctx.shadowColor = "rgba(0,0,0,0.6)";
  ctx.shadowBlur = 10;
  ctx.beginPath();
  const r = 15;
  ctx.moveTo(x + r, y);
  ctx.lineTo(x + boxWidth - r, y);
  ctx.quadraticCurveTo(x + boxWidth, y, x + boxWidth, y + r);
  ctx.lineTo(x + boxWidth, y + boxHeight - r);
  ctx.quadraticCurveTo(x + boxWidth, y + boxHeight, x + boxWidth - r, y + boxHeight);
  ctx.lineTo(x + r, y + boxHeight);
  ctx.quadraticCurveTo(x, y + boxHeight, x, y + boxHeight - r);
  ctx.lineTo(x, y + r);
  ctx.quadraticCurveTo(x, y, x + r, y);
  ctx.closePath();
  ctx.fill();

  // تنظیم سایه برای متن
  ctx.shadowColor = "rgba(255,255,255,0.4)";
  ctx.shadowBlur = 4;
  ctx.fillStyle = "white";
  ctx.font = "bold 16px Orbitron, sans-serif";
  ctx.textAlign = "center";
  ctx.fillText("QR CODE", qrSize / 2, y + 28);

  ctx.font = "bold 14px Vazirmatn, sans-serif";
  ctx.fillText("Rubika:VPS_Plus", qrSize / 2, y + 55);

  increaseCount();
  document.getElementById("limitMsg").textContent = "✅ QR شما با موفقیت ساخته شد.";
}

// دانلود QR
function downloadQR() {
  const link = document.createElement('a');
  link.download = 'Rubika_QR.png';
  link.href = canvas.toDataURL('image/png');
  link.click();
}
</script>
</body>
</html>
